<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>播放列表管理器测试</title>
	</head>
	<body>
		<h3>测试音乐播放列表管理器</h3>

		<button type="button" onclick="initAndPlay()">设置播放列表并播放</button>

		<p>
			<button type="button" onclick="onPreviousClick()">上一首</button>
			<button type="button" onclick="onPlayClick()" id="playOrPause">播放</button>
			<button type="button" onclick="onNextClick()">下一曲</button>
			<button type="button" onclick="onLoopModelClick()" id="loopModel">循环模式</button>
			<button type="button" onclick="onSeekClick()">跳转到音乐最后几秒</button>
		</p>

		<p>播放的音乐标题：<span id="title"></span></p>

		<p>
			音量：<input type="range" id="volumeInput" min="0" max="1" step="0.1" oninput="onVolumeChanged(this.value)" />
		</p>

		<p>总时长：<span id="duration"></span></p>

		<p>当前进度：<span id="progress"></span></p>


		<!-- ==================通用资源 -->
		<!-- jquery框架 -->
		<script src="../vender/jquery/jquery.min.js" crossorigin="anonymous"></script>
		<!-- /==================通用资源 -->

		<script src="../js/constants.js"></script>
		<script src="../js/common.js"></script>

		<!-- 播放管理器监听器 -->
		<script src="../js/player/MusicPlayerListener.js"></script>
		<!-- 播放管理器 -->
		<script src="../js/player/MusicPlayerManager.js"></script>
		<!-- 播放列表管理器 -->
		<script src="../js/player/ListManager.js"></script>

		<script>
			//创建列表管理器
			listManager = new ListManager();

			//获取音乐播放管理器
			musicPlayerManager = listManager.musicPlayerManager;

			//创建播放管理器监听器
			var listener = new MusicPlayerListener();

			//设置需要关注的事件
			//准备播放完成了
			listener.onPrepared = function(data) {
				//标题
				$("#title").text(data.title);
				//总时长
				$("#duration").text(data.duration);
			}
			//播放进度
			listener.onProgress = function(data) {
				$("#progress").text(data.progress);
			}
			//已经播放了
			listener.onPlaying = function(data) {
				$("#playOrPause").text("暂停");
			}
			//暂停了
			listener.onPaused = function(data) {
				$("#playOrPause").text("播放");
			}
			//出错了
			listener.onError = function(data, error) {
				$("#error").text("出错了，错误码:" + error.code);
			}

			//添加监听器到播放管理器
			musicPlayerManager.addMusicPlayerListener(listener);

			/**
			 * 初始化并播放音乐
			 */
			function initAndPlay() {
				//设置测试模拟播放列表
				var musicPlayList = [{
						"id": 1,
						"title": "拥抱你离去",
						"uri": "assets/yong_bao_ni_de_ni_de_li_qu.mp3",
					},
					{
						"id": 2,
						"title": "缘分惹的祸",
						"uri": "assets/yuanfengredehuo_andongyang.mp3",
					},
					{
						"id": 3,
						"title": "爱拼才会赢",
						"uri": "assets/s1.mp3",
					}
				];

				//设置播放列表
				listManager.setDatum(musicPlayList);

				//播放第一首音乐
				listManager.play(musicPlayList[0]);
			}
			
			/**
			 * 上一曲
			 */
			function onPreviousClick(){
				listManager.play(listManager.previous());
			}

			/**
			 * 播放点击了
			 */
			function onPlayClick() {
				if (musicPlayerManager.isPlaying()) {
					//当前正在播放，则暂停
					listManager.pause();
				} else {
					listManager.resume();
				}
			}
			
			/**
			 * 下一曲
			 */
			function onNextClick(){
				listManager.play(listManager.next());
			}


			/**
			 * 循环模式点击
			 */
			function onLoopModelClick() {
				//更改循环模式
				listManager.changeLoopModel();

				//显示当前循环模式
				showLoopModel();
			}

			/**
			 * 显示当前循环模式
			 */
			function showLoopModel() {
				//获取当前循环模式
				let model = listManager.getLoopModel();

				//循环模式按钮
				let loopModel = $("#loopModel");

				//判断，更改循环模式内容
				switch (model) {
					case MODEL_LOOP_RANDOM:
						loopModel.text("随机循环");
						break;
					case MODEL_LOOP_LIST:
						loopModel.text("列表循环");
						break;
					case MODEL_LOOP_ONE:
						loopModel.text("单曲循环");
						break;
				}
			}
			
			/**
			 * 从指定进度位置开始播放音乐
			 */
			function onSeekClick(){
				listManager.seekTo(235);
			}
			
			/**
			 * 修改播放音量
			 * @param {Object} data
			 */
			function onVolumeChanged(data){
				musicPlayerManager.setVolume(data);
			}
		</script>


	</body>
</html>
